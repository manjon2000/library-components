import { booleanAttribute, ChangeDetectionStrategy, Component, EventEmitter, Input, Output } from '@angular/core';
import { CommonModule } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "./calendar.service";
import * as i2 from "@angular/common";
export class UICalendarComponent {
    set startDate(start) {
        const startDate = new Date(start);
        startDate.setHours(0, 0, 0, 0);
        this._startDate = startDate;
        this.cdr.markForCheck();
    }
    ;
    set endDate(end) {
        const endDate = new Date(end);
        endDate.setHours(0, 0, 0, 0);
        console.log(endDate);
        this._endDate = endDate;
        this.cdr.markForCheck();
    }
    constructor(cdr, calendarService) {
        this.cdr = cdr;
        this.calendarService = calendarService;
        this.type = 'single';
        this.cellAspectRatio = 1;
        this.isShowDaysOtherMonth = true;
        this.dateSelect = new EventEmitter();
        this.dateRangeSelect = new EventEmitter();
        this.dateMultipleSelect = new EventEmitter();
        this.currentDate = new Date();
        this._currentOptionDate = 'start';
    }
    ngOnInit() {
        const date = this._startDate || new Date();
        this.setYearMonth(date);
        this.initWeeks();
        this.weeks = this.calendarService.initWeeks$;
    }
    ngOnChanges(changes) {
        if (changes['type'] && (changes['type'].previousValue !== changes['type'].currentValue)) {
            this.initWeeks();
        }
        if (changes['endDate'] && (changes['endDate'].previousValue !== changes['endDate'].currentValue)) {
            const endDate = new Date(changes['endDate'].currentValue);
            endDate.setHours(0, 0, 0, 0);
            this._endDate = endDate;
            this.setYearMonth(endDate);
            this.initWeeks();
        }
        if (changes['startDate'] && (changes['startDate'].previousValue !== changes['startDate'].currentValue)) {
            const startDate = new Date(changes['startDate'].currentValue);
            startDate.setHours(0, 0, 0, 0);
            this._startDate = startDate;
            this.setYearMonth(startDate);
            this.initWeeks();
        }
    }
    ngOnDestroy() {
        if (this._subscriptionWeeks) {
            this._subscriptionWeeks.unsubscribe();
        }
    }
    initWeeks() {
        this.calendarService
            .decomposeMonthIntoWeeks(this.currentYear, this.currentMonth, this.type, this.isShowDaysOtherMonth, this._startDate, this._endDate);
    }
    trackByIndex(index, item) {
        return index; // Rastrea por índice
    }
    setCellAspectRatio(numCols) {
        const padding = (100 * this.cellAspectRatio) / numCols / 2;
        this._cellPadding = `${padding.toFixed(2)}%`;
        this._cellWidth = `${100 / numCols}%`;
        this.cdr.markForCheck();
    }
    onPrevMonth() {
        if (this.currentMonth === 1) {
            this.currentMonth = 12;
            this.currentYear--;
        }
        else {
            this.currentMonth--;
        }
        this.initWeeks();
        this.cdr.markForCheck();
    }
    onNextMonth() {
        if ((this.currentMonth + 1) === 12) {
            this.currentMonth = 1;
            this.currentYear++;
        }
        else {
            this.currentMonth++;
        }
        this.initWeeks();
        this.cdr.markForCheck();
    }
    isDateSelected(dateUnix) {
        const initialDate = this.calendarService.formatToUnix(this._startDate);
        return dateUnix === initialDate;
    }
    isCurrentDate(dateUnix) {
        const currentDateToUnix = this.calendarService.formatToUnix(new Date());
        return (dateUnix ? dateUnix === currentDateToUnix : false);
    }
    onSelectedDate(option) {
        switch (this.type) {
            case 'single':
                const startDate = this.calendarService.onSelectedDateSingle(option?.ISO8601);
                this._startDate = startDate;
                this.dateSelect.emit(startDate);
                break;
            case 'range':
                this.onSelectedDateRange(option?.ISO8601);
                this.toggleOptionDate();
                break;
        }
        this.cdr.markForCheck();
    }
    onSelectedDateRange(ISO8601) {
        switch (this._currentOptionDate) {
            case 'start':
                const startDate = this.calendarService.onSelectedDateSingle(ISO8601);
                this._startDate = startDate;
                this.initWeeks();
                break;
            case 'end':
                const endDate = this.calendarService.onSelectedDateSingle(ISO8601);
                this._endDate = endDate;
                this.initWeeks();
                if (this.verifyDateRange()) {
                    this.dateRangeSelect.emit({ start: this._startDate, end: this._endDate });
                }
                break;
        }
    }
    isEndDateRange(dateUnix) {
        return (this._endDate ?
            dateUnix === this.calendarService.formatToUnix(this._endDate) :
            false);
    }
    setYearMonth(date) {
        const currentDate = new Date(date);
        this.currentYear = currentDate.getFullYear();
        this.currentMonth = (currentDate.getMonth() + 1);
    }
    toggleOptionDate() {
        if (this._currentOptionDate === 'start') {
            if (this._endDate) {
                this._endDate = undefined;
            }
            this._currentOptionDate = 'end';
        }
        else {
            this.initWeeks();
            this._currentOptionDate = 'start';
        }
    }
    verifyDateRange() {
        if (!this._endDate)
            return false;
        const startDateToUnix = this.calendarService
            .formatToUnix(this._startDate);
        const endDateToUnix = this.calendarService
            .formatToUnix(this._endDate);
        return !!(endDateToUnix >= startDateToUnix);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: UICalendarComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.CalendarService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.12", type: UICalendarComponent, isStandalone: true, selector: "ui-calendar", inputs: { startDate: "startDate", endDate: "endDate", type: "type", limitYearsPreview: "limitYearsPreview", cellAspectRatio: "cellAspectRatio", isShowDaysOtherMonth: ["isShowDaysOtherMonth", "isShowDaysOtherMonth", booleanAttribute], isResponsive: ["isResponsive", "isResponsive", booleanAttribute], isSelectable: ["isSelectable", "isSelectable", booleanAttribute], isSelectCurrentDay: ["isSelectCurrentDay", "isSelectCurrentDay", booleanAttribute] }, outputs: { dateSelect: "dateSelect", dateRangeSelect: "dateRangeSelect", dateMultipleSelect: "dateMultipleSelect" }, usesOnChanges: true, ngImport: i0, template: "<div class=\"ui-calendar\">\n  <div class=\"ui-calendar-controls\">\n    <button aria-label=\"Preview Month\" (click)=\"onPrevMonth()\">\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M15.8326 4.18024C16.0558 4.42056 16.0558 4.8102 15.8326 5.05053L9.37955 12L15.8326 18.9495C16.0558 19.1898 16.0558 19.5794 15.8326 19.8198C15.6095 20.0601 15.2477 20.0601 15.0245 19.8198L8.16737 12.4351C7.94421 12.1948 7.94421 11.8052 8.16737 11.5649L15.0245 4.18024C15.2477 3.93992 15.6095 3.93992 15.8326 4.18024Z\" fill=\"black\"/>\n      </svg>\n    </button>\n    <div class=\"ui-calendar-controls-others\">\n      <button>Enero</button>\n      <button>2025</button>\n    </div>\n    <button aria-label=\"Next Month\" (click)=\"onNextMonth()\">\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.16737 4.18024C8.39052 3.93992 8.75233 3.93992 8.97549 4.18024L15.8326 11.5649C15.9398 11.6803 16 11.8368 16 12C16 12.1632 15.9398 12.3197 15.8326 12.4351L8.97549 19.8198C8.75233 20.0601 8.39052 20.0601 8.16737 19.8198C7.94421 19.5794 7.94421 19.1898 8.16737 18.9495L14.6204 12L8.16737 5.05053C7.94421 4.8102 7.94421 4.42056 8.16737 4.18024Z\" fill=\"black\"/>\n      </svg>\n    </button>\n  </div>\n  <table role=\"grid\" class=\"ui-calendar-table\">\n    <thead class=\"ui-calendar-table-head\">\n      <tr>\n        <th scope=\"col\">\n          <span>L</span>\n        </th>\n        <th scope=\"col\">\n          <span>M</span>\n        </th>\n        <th scope=\"col\">\n          <span>X</span>\n        </th>\n        <th scope=\"col\">\n          <span>J</span>\n        </th>\n        <th scope=\"col\">\n          <span>V</span>\n        </th>\n        <th scope=\"col\">\n          <span>S</span>\n        </th>\n        <th scope=\"col\">\n          <span>D</span>\n        </th>\n      </tr>\n    </thead>\n    <tbody class=\"ui-calendar-table-body\">\n      @for (week of weeks | async; let idx = $index; track trackByIndex;) {\n      <tr role=\"row\">\n        @for (day of week; track day.ISO8601) {\n          <td\n            role=\"gridcell\"\n            [style.width]=\"_cellWidth\"\n            [style.paddingTop]=\"_cellPadding\"\n            [style.paddingBottom]=\"_cellPadding\"\n            >\n            <button\n              role=\"option\"\n              [class.readonly]=\"day.isAnotherMonth\"\n              [attr.disabled]=\"day.isAnotherMonth || null\"\n              [class.range]=\"day.isSelected && _endDate && type === 'range'\"\n              [class.end-date]=\"isEndDateRange(day.unix)\"\n              [attr.tabIndex]=\"day.isAnotherMonth ? -1 : 0\"\n              [attr.aria-current]=\"isSelectCurrentDay && type === 'single' ? (isCurrentDate(day.unix) ? 'date' : null) : null\"\n              [attr.aria-selected]=\"isDateSelected(day.unix)\"\n              [attr.data-date]=\"day.ISO8601 || null\"\n              (click)=\"onSelectedDate(day)\">\n              {{ day.day }}\n            </button>\n          </td>\n        }\n      </tr>\n      }\n    </tbody>\n  </table>\n</div>\n", styles: [".ui-calendar{width:280px;border:1px solid #DEDEDE;padding:4px 0;border-radius:4px}.ui-calendar-controls{display:flex;align-items:center;justify-content:space-between;padding:.24rem .75rem}.ui-calendar-controls button{height:max-content;display:flex;align-items:center;justify-content:center}.ui-calendar-controls button:focus{border-radius:8px;outline-offset:2px;outline:1px solid red}.ui-calendar-controls-others{display:flex;gap:.25rem}.ui-calendar-controls-others button{font:inherit;font-size:14px;line-height:16px}.ui-calendar-table{width:100%;border-collapse:collapse;table-layout:fixed}.ui-calendar-table-head{margin-bottom:1rem;border-bottom:1px solid #DEDEDE}.ui-calendar-table-head th{-webkit-user-select:none;user-select:none}.ui-calendar-table-head th:hover{cursor:default}.ui-calendar-table-head th span{font-weight:500;font-size:14px;line-height:16px}.ui-calendar-table-body tr{margin:0;padding:0;height:0;position:relative;text-align:center}.ui-calendar-table-body tr td button{width:100%;height:auto;display:flex;align-items:center;justify-content:center;margin:0;padding:0;aspect-ratio:1;font-weight:500;font-size:14px;line-height:16px;margin:.15rem 0;color:var(--grayscale-black)}.ui-calendar-table-body tr td button:focus{border-radius:999px;outline:1px solid var(--corporate-purple)}.ui-calendar-table-body tr td button.range{background-color:var(--corporate-purple);color:var(--grayscale-white)}.ui-calendar-table-body tr td button.range:is([aria-selected=true]){border-radius:999px 0 0 999px}.ui-calendar-table-body tr td button.range:is(.ui-calendar-table-body tr td button.end-date){border-radius:0 999px 999px 0}.ui-calendar-table-body tr td button[aria-selected=true]:has(.ui-calendar-table-body tr td button.range){border-radius:999px 0 0 999px}.ui-calendar-table-body tr td button:not(.ui-calendar-table-body tr td button[disabled]):not(.ui-calendar-table-body tr td button[aria-current]):not(.ui-calendar-table-body tr td button.range):hover{border-radius:999px;border:1px solid var(--corporate-purple);background-color:#9e3fe731;cursor:pointer}.ui-calendar-table-body tr td button[aria-current]{background-color:var(--corporate-purple);color:var(--grayscale-white);border-radius:999px}.ui-calendar-table-body tr td button:not(.ui-calendar-table-body tr td button[disabled]):not(.ui-calendar-table-body tr td button.range):is(.ui-calendar-table-body tr td button[aria-selected=true]){border-radius:999px;border:1px solid var(--corporate-purple);background-color:#9e3fe731;cursor:pointer}.ui-calendar-table-body tr td button.readonly{font-weight:400;color:#707070;pointer-events:none}.ui-calendar-table-body tr td button.readonly:hover{cursor:default}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "pipe", type: i2.AsyncPipe, name: "async" }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: UICalendarComponent, decorators: [{
            type: Component,
            args: [{ selector: 'ui-calendar', standalone: true, imports: [
                        CommonModule,
                    ], changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"ui-calendar\">\n  <div class=\"ui-calendar-controls\">\n    <button aria-label=\"Preview Month\" (click)=\"onPrevMonth()\">\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M15.8326 4.18024C16.0558 4.42056 16.0558 4.8102 15.8326 5.05053L9.37955 12L15.8326 18.9495C16.0558 19.1898 16.0558 19.5794 15.8326 19.8198C15.6095 20.0601 15.2477 20.0601 15.0245 19.8198L8.16737 12.4351C7.94421 12.1948 7.94421 11.8052 8.16737 11.5649L15.0245 4.18024C15.2477 3.93992 15.6095 3.93992 15.8326 4.18024Z\" fill=\"black\"/>\n      </svg>\n    </button>\n    <div class=\"ui-calendar-controls-others\">\n      <button>Enero</button>\n      <button>2025</button>\n    </div>\n    <button aria-label=\"Next Month\" (click)=\"onNextMonth()\">\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n        <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8.16737 4.18024C8.39052 3.93992 8.75233 3.93992 8.97549 4.18024L15.8326 11.5649C15.9398 11.6803 16 11.8368 16 12C16 12.1632 15.9398 12.3197 15.8326 12.4351L8.97549 19.8198C8.75233 20.0601 8.39052 20.0601 8.16737 19.8198C7.94421 19.5794 7.94421 19.1898 8.16737 18.9495L14.6204 12L8.16737 5.05053C7.94421 4.8102 7.94421 4.42056 8.16737 4.18024Z\" fill=\"black\"/>\n      </svg>\n    </button>\n  </div>\n  <table role=\"grid\" class=\"ui-calendar-table\">\n    <thead class=\"ui-calendar-table-head\">\n      <tr>\n        <th scope=\"col\">\n          <span>L</span>\n        </th>\n        <th scope=\"col\">\n          <span>M</span>\n        </th>\n        <th scope=\"col\">\n          <span>X</span>\n        </th>\n        <th scope=\"col\">\n          <span>J</span>\n        </th>\n        <th scope=\"col\">\n          <span>V</span>\n        </th>\n        <th scope=\"col\">\n          <span>S</span>\n        </th>\n        <th scope=\"col\">\n          <span>D</span>\n        </th>\n      </tr>\n    </thead>\n    <tbody class=\"ui-calendar-table-body\">\n      @for (week of weeks | async; let idx = $index; track trackByIndex;) {\n      <tr role=\"row\">\n        @for (day of week; track day.ISO8601) {\n          <td\n            role=\"gridcell\"\n            [style.width]=\"_cellWidth\"\n            [style.paddingTop]=\"_cellPadding\"\n            [style.paddingBottom]=\"_cellPadding\"\n            >\n            <button\n              role=\"option\"\n              [class.readonly]=\"day.isAnotherMonth\"\n              [attr.disabled]=\"day.isAnotherMonth || null\"\n              [class.range]=\"day.isSelected && _endDate && type === 'range'\"\n              [class.end-date]=\"isEndDateRange(day.unix)\"\n              [attr.tabIndex]=\"day.isAnotherMonth ? -1 : 0\"\n              [attr.aria-current]=\"isSelectCurrentDay && type === 'single' ? (isCurrentDate(day.unix) ? 'date' : null) : null\"\n              [attr.aria-selected]=\"isDateSelected(day.unix)\"\n              [attr.data-date]=\"day.ISO8601 || null\"\n              (click)=\"onSelectedDate(day)\">\n              {{ day.day }}\n            </button>\n          </td>\n        }\n      </tr>\n      }\n    </tbody>\n  </table>\n</div>\n", styles: [".ui-calendar{width:280px;border:1px solid #DEDEDE;padding:4px 0;border-radius:4px}.ui-calendar-controls{display:flex;align-items:center;justify-content:space-between;padding:.24rem .75rem}.ui-calendar-controls button{height:max-content;display:flex;align-items:center;justify-content:center}.ui-calendar-controls button:focus{border-radius:8px;outline-offset:2px;outline:1px solid red}.ui-calendar-controls-others{display:flex;gap:.25rem}.ui-calendar-controls-others button{font:inherit;font-size:14px;line-height:16px}.ui-calendar-table{width:100%;border-collapse:collapse;table-layout:fixed}.ui-calendar-table-head{margin-bottom:1rem;border-bottom:1px solid #DEDEDE}.ui-calendar-table-head th{-webkit-user-select:none;user-select:none}.ui-calendar-table-head th:hover{cursor:default}.ui-calendar-table-head th span{font-weight:500;font-size:14px;line-height:16px}.ui-calendar-table-body tr{margin:0;padding:0;height:0;position:relative;text-align:center}.ui-calendar-table-body tr td button{width:100%;height:auto;display:flex;align-items:center;justify-content:center;margin:0;padding:0;aspect-ratio:1;font-weight:500;font-size:14px;line-height:16px;margin:.15rem 0;color:var(--grayscale-black)}.ui-calendar-table-body tr td button:focus{border-radius:999px;outline:1px solid var(--corporate-purple)}.ui-calendar-table-body tr td button.range{background-color:var(--corporate-purple);color:var(--grayscale-white)}.ui-calendar-table-body tr td button.range:is([aria-selected=true]){border-radius:999px 0 0 999px}.ui-calendar-table-body tr td button.range:is(.ui-calendar-table-body tr td button.end-date){border-radius:0 999px 999px 0}.ui-calendar-table-body tr td button[aria-selected=true]:has(.ui-calendar-table-body tr td button.range){border-radius:999px 0 0 999px}.ui-calendar-table-body tr td button:not(.ui-calendar-table-body tr td button[disabled]):not(.ui-calendar-table-body tr td button[aria-current]):not(.ui-calendar-table-body tr td button.range):hover{border-radius:999px;border:1px solid var(--corporate-purple);background-color:#9e3fe731;cursor:pointer}.ui-calendar-table-body tr td button[aria-current]{background-color:var(--corporate-purple);color:var(--grayscale-white);border-radius:999px}.ui-calendar-table-body tr td button:not(.ui-calendar-table-body tr td button[disabled]):not(.ui-calendar-table-body tr td button.range):is(.ui-calendar-table-body tr td button[aria-selected=true]){border-radius:999px;border:1px solid var(--corporate-purple);background-color:#9e3fe731;cursor:pointer}.ui-calendar-table-body tr td button.readonly{font-weight:400;color:#707070;pointer-events:none}.ui-calendar-table-body tr td button.readonly:hover{cursor:default}\n"] }]
        }], ctorParameters: () => [{ type: i0.ChangeDetectorRef }, { type: i1.CalendarService }], propDecorators: { startDate: [{
                type: Input
            }], endDate: [{
                type: Input
            }], type: [{
                type: Input
            }], limitYearsPreview: [{
                type: Input
            }], cellAspectRatio: [{
                type: Input
            }], isShowDaysOtherMonth: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], isResponsive: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], isSelectable: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], isSelectCurrentDay: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], dateSelect: [{
                type: Output
            }], dateRangeSelect: [{
                type: Output
            }], dateMultipleSelect: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbWFuam9uLXVpL3NyYy9saWIvY29tcG9uZW50cy9jYWxlbmRhci9jYWxlbmRhci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9tYW5qb24tdWkvc3JjL2xpYi9jb21wb25lbnRzL2NhbGVuZGFyL2NhbGVuZGFyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSx1QkFBdUIsRUFBcUIsU0FBUyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQWdDLE1BQU0sRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFFbEwsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDOzs7O0FBYy9DLE1BQU0sT0FBTyxtQkFBbUI7SUFDOUIsSUFDSSxTQUFTLENBQUMsS0FBVztRQUN2QixNQUFNLFNBQVMsR0FBRyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNsQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTVCLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1FBQzVCLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUFBLENBQUM7SUFDRixJQUNJLE9BQU8sQ0FBQyxHQUFTO1FBQ25CLE1BQU0sT0FBTyxHQUFHLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzlCLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFN0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUVwQixJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQztRQUN4QixJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQzFCLENBQUM7SUF3QkQsWUFDVSxHQUFzQixFQUN0QixlQUFnQztRQURoQyxRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUN0QixvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUF6QmpDLFNBQUksR0FBa0IsUUFBUSxDQUFDO1FBRS9CLG9CQUFlLEdBQVcsQ0FBQyxDQUFDO1FBQ0cseUJBQW9CLEdBQVksSUFBSSxDQUFDO1FBS25FLGVBQVUsR0FBdUIsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUMxRCxvQkFBZSxHQUE4QixJQUFJLFlBQVksRUFBZSxDQUFDO1FBQzdFLHVCQUFrQixHQUE4QixJQUFJLFlBQVksRUFBZSxDQUFDO1FBSW5GLGdCQUFXLEdBQVMsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQU05Qix1QkFBa0IsR0FBb0IsT0FBTyxDQUFDO0lBTWxELENBQUM7SUFFTCxRQUFRO1FBQ04sTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLElBQUksRUFBRSxDQUFBO1FBQzFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUM7SUFDL0MsQ0FBQztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxhQUFhLEtBQUssT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUM7WUFDeEYsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ25CLENBQUM7UUFDRCxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxhQUFhLEtBQUssT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUM7WUFDakcsTUFBTSxPQUFPLEdBQUcsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQzFELE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFN0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7WUFDeEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUMzQixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDbkIsQ0FBQztRQUNELElBQUksT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLGFBQWEsS0FBSyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQztZQUN2RyxNQUFNLFNBQVMsR0FBRyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDOUQsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUUvQixJQUFJLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQztZQUM1QixJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzdCLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNuQixDQUFDO0lBQ0gsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFHLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1lBQzNCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN4QyxDQUFDO0lBQ0gsQ0FBQztJQUVNLFNBQVM7UUFDZCxJQUFJLENBQUMsZUFBZTthQUNqQix1QkFBdUIsQ0FDdEIsSUFBSSxDQUFDLFdBQVcsRUFDaEIsSUFBSSxDQUFDLFlBQVksRUFDakIsSUFBSSxDQUFDLElBQUksRUFDVCxJQUFJLENBQUMsb0JBQW9CLEVBQ3pCLElBQUksQ0FBQyxVQUFVLEVBQ2YsSUFBSSxDQUFDLFFBQVEsQ0FDZCxDQUFDO0lBQ04sQ0FBQztJQUVNLFlBQVksQ0FBQyxLQUFhLEVBQUUsSUFBUztRQUMxQyxPQUFPLEtBQUssQ0FBQyxDQUFDLHFCQUFxQjtJQUNyQyxDQUFDO0lBRU0sa0JBQWtCLENBQUMsT0FBZTtRQUN2QyxNQUFNLE9BQU8sR0FBRyxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsT0FBTyxHQUFHLENBQUMsQ0FBQztRQUMzRCxJQUFJLENBQUMsWUFBWSxHQUFHLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQzdDLElBQUksQ0FBQyxVQUFVLEdBQUcsR0FBRyxHQUFHLEdBQUcsT0FBTyxHQUFHLENBQUM7UUFFdEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUMxQixDQUFDO0lBRU0sV0FBVztRQUNoQixJQUFJLElBQUksQ0FBQyxZQUFZLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDNUIsSUFBSSxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUM7WUFDdkIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3JCLENBQUM7YUFBTSxDQUFDO1lBQ04sSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3RCLENBQUM7UUFFRCxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUMxQixDQUFDO0lBRU0sV0FBVztRQUNoQixJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUNuQyxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztZQUN0QixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDckIsQ0FBQzthQUFNLENBQUM7WUFDTixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDdEIsQ0FBQztRQUVELElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFTSxjQUFjLENBQUMsUUFBNEI7UUFDaEQsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRXZFLE9BQU8sUUFBUSxLQUFLLFdBQVcsQ0FBQztJQUNsQyxDQUFDO0lBRU0sYUFBYSxDQUFDLFFBQTRCO1FBQy9DLE1BQU0saUJBQWlCLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRXhFLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsS0FBSyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDN0QsQ0FBQztJQUVNLGNBQWMsQ0FBQyxNQUFjO1FBRWxDLFFBQU8sSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2pCLEtBQUssUUFBUTtnQkFDWCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztnQkFDN0UsSUFBSSxDQUFDLFVBQVUsR0FBRyxTQUFTLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUNoQyxNQUFNO1lBQ1IsS0FBSyxPQUFPO2dCQUNWLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQzFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUN4QixNQUFNO1FBQ1YsQ0FBQztRQUVELElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVNLG1CQUFtQixDQUFDLE9BQTJCO1FBQ3BELFFBQU8sSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDL0IsS0FBSyxPQUFPO2dCQUNWLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsb0JBQW9CLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ3JFLElBQUksQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO2dCQUM1QixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ2pCLE1BQU07WUFDUixLQUFLLEtBQUs7Z0JBQ1IsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDbkUsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7Z0JBQ3hCLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFFakIsSUFBRyxJQUFJLENBQUMsZUFBZSxFQUFFLEVBQUUsQ0FBQztvQkFDMUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBQyxDQUFDLENBQUM7Z0JBQzFFLENBQUM7Z0JBRUQsTUFBTTtRQUNWLENBQUM7SUFDSCxDQUFDO0lBRU0sY0FBYyxDQUFDLFFBQTRCO1FBQ2hELE9BQU8sQ0FDTCxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDYixRQUFRLEtBQUssSUFBSSxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDL0QsS0FBSyxDQUNSLENBQUM7SUFDSixDQUFDO0lBRU8sWUFBWSxDQUFDLElBQVU7UUFDN0IsTUFBTSxXQUFXLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbkMsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDN0MsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLFdBQVcsQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRU8sZ0JBQWdCO1FBQ3RCLElBQUcsSUFBSSxDQUFDLGtCQUFrQixLQUFLLE9BQU8sRUFBRSxDQUFDO1lBQ3ZDLElBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUNqQixJQUFJLENBQUMsUUFBUSxHQUFHLFNBQVMsQ0FBQztZQUM1QixDQUFDO1lBQ0QsSUFBSSxDQUFDLGtCQUFrQixHQUFHLEtBQUssQ0FBQztRQUNsQyxDQUFDO2FBQUssQ0FBQztZQUNMLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNqQixJQUFJLENBQUMsa0JBQWtCLEdBQUcsT0FBTyxDQUFDO1FBQ3BDLENBQUM7SUFDSCxDQUFDO0lBRU8sZUFBZTtRQUNyQixJQUFHLENBQUMsSUFBSSxDQUFDLFFBQVE7WUFBRSxPQUFPLEtBQUssQ0FBQztRQUNoQyxNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsZUFBZTthQUN6QyxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxlQUFlO2FBQ3ZDLFlBQVksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFL0IsT0FBTyxDQUFDLENBQUMsQ0FBQyxhQUFhLElBQUksZUFBZSxDQUFDLENBQUM7SUFDOUMsQ0FBQzsrR0F0TlUsbUJBQW1CO21HQUFuQixtQkFBbUIsc1FBc0JWLGdCQUFnQixrREFDaEIsZ0JBQWdCLGtEQUNoQixnQkFBZ0Isb0VBQ2hCLGdCQUFnQix1S0N6Q3RDLDBzR0F5RUEsa3JGRC9ESSxZQUFZOzs0RkFNSCxtQkFBbUI7a0JBVi9CLFNBQVM7K0JBQ0UsYUFBYSxjQUNYLElBQUksV0FDUDt3QkFDUCxZQUFZO3FCQUNiLG1CQUdnQix1QkFBdUIsQ0FBQyxNQUFNO29IQUkzQyxTQUFTO3NCQURaLEtBQUs7Z0JBU0YsT0FBTztzQkFEVixLQUFLO2dCQVVHLElBQUk7c0JBQVosS0FBSztnQkFDRyxpQkFBaUI7c0JBQXpCLEtBQUs7Z0JBQ0csZUFBZTtzQkFBdkIsS0FBSztnQkFDa0Msb0JBQW9CO3NCQUEzRCxLQUFLO3VCQUFDLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO2dCQUNFLFlBQVk7c0JBQW5ELEtBQUs7dUJBQUMsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUU7Z0JBQ0UsWUFBWTtzQkFBbkQsS0FBSzt1QkFBQyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRTtnQkFDRSxrQkFBa0I7c0JBQXpELEtBQUs7dUJBQUMsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUU7Z0JBRTVCLFVBQVU7c0JBQW5CLE1BQU07Z0JBQ0csZUFBZTtzQkFBeEIsTUFBTTtnQkFDRyxrQkFBa0I7c0JBQTNCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBib29sZWFuQXR0cmlidXRlLCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3ksIE9uSW5pdCwgT3V0cHV0LCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJRGF0ZXNSYW5nZSwgSVdlZWtzLCBUVHlwZUNhbGVuZGFyIH0gZnJvbSAnLi9jYWxlbmRhci5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENhbGVuZGFyU2VydmljZSB9IGZyb20gJy4vY2FsZW5kYXIuc2VydmljZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndWktY2FsZW5kYXInLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgQ29tbW9uTW9kdWxlLFxuICBdLFxuICB0ZW1wbGF0ZVVybDogJy4vY2FsZW5kYXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybDogJy4vY2FsZW5kYXIuY29tcG9uZW50LnNjc3MnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgVUlDYWxlbmRhckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKVxuICBzZXQgc3RhcnREYXRlKHN0YXJ0OiBEYXRlKSB7XG4gICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoc3RhcnQpO1xuICAgIHN0YXJ0RGF0ZS5zZXRIb3VycygwLDAsMCwwKTtcblxuICAgIHRoaXMuX3N0YXJ0RGF0ZSA9IHN0YXJ0RGF0ZTtcbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgfTtcbiAgQElucHV0KClcbiAgc2V0IGVuZERhdGUoZW5kOiBEYXRlKSB7XG4gICAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKGVuZCk7XG4gICAgZW5kRGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcblxuICAgIGNvbnNvbGUubG9nKGVuZERhdGUpXG5cbiAgICB0aGlzLl9lbmREYXRlID0gZW5kRGF0ZTtcbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuICBASW5wdXQoKSB0eXBlOiBUVHlwZUNhbGVuZGFyID0gJ3NpbmdsZSc7XG4gIEBJbnB1dCgpIGxpbWl0WWVhcnNQcmV2aWV3ITogbnVtYmVyO1xuICBASW5wdXQoKSBjZWxsQXNwZWN0UmF0aW86IG51bWJlciA9IDE7XG4gIEBJbnB1dCh7IHRyYW5zZm9ybTogYm9vbGVhbkF0dHJpYnV0ZSB9KSBpc1Nob3dEYXlzT3RoZXJNb250aDogYm9vbGVhbiA9IHRydWU7XG4gIEBJbnB1dCh7IHRyYW5zZm9ybTogYm9vbGVhbkF0dHJpYnV0ZSB9KSBpc1Jlc3BvbnNpdmUhOiBib29sZWFuO1xuICBASW5wdXQoeyB0cmFuc2Zvcm06IGJvb2xlYW5BdHRyaWJ1dGUgfSkgaXNTZWxlY3RhYmxlITogYm9vbGVhbjtcbiAgQElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pIGlzU2VsZWN0Q3VycmVudERheSE6IGJvb2xlYW47XG5cbiAgQE91dHB1dCgpIGRhdGVTZWxlY3Q6IEV2ZW50RW1pdHRlcjxEYXRlPiA9IG5ldyBFdmVudEVtaXR0ZXI8RGF0ZT4oKTtcbiAgQE91dHB1dCgpIGRhdGVSYW5nZVNlbGVjdDogRXZlbnRFbWl0dGVyPElEYXRlc1JhbmdlPiA9IG5ldyBFdmVudEVtaXR0ZXI8SURhdGVzUmFuZ2U+KCk7XG4gIEBPdXRwdXQoKSBkYXRlTXVsdGlwbGVTZWxlY3Q6IEV2ZW50RW1pdHRlcjxBcnJheTxEYXRlPj4gPSBuZXcgRXZlbnRFbWl0dGVyPEFycmF5PERhdGU+PigpO1xuXG4gIHB1YmxpYyBfc3RhcnREYXRlITogRGF0ZTtcbiAgcHVibGljIF9lbmREYXRlITogRGF0ZSB8IHVuZGVmaW5lZDtcbiAgcHVibGljIGN1cnJlbnREYXRlOiBEYXRlID0gbmV3IERhdGUoKTtcbiAgcHVibGljIGN1cnJlbnRZZWFyITogbnVtYmVyO1xuICBwdWJsaWMgY3VycmVudE1vbnRoITogbnVtYmVyO1xuICBwdWJsaWMgd2Vla3MhOiBPYnNlcnZhYmxlPElXZWVrc1tdW10+O1xuICBwdWJsaWMgX2NlbGxQYWRkaW5nITogc3RyaW5nO1xuICBwdWJsaWMgX2NlbGxXaWR0aCE6IHN0cmluZztcbiAgcHJpdmF0ZSBfY3VycmVudE9wdGlvbkRhdGU6ICdzdGFydCcgfCAnZW5kJyA9ICdzdGFydCc7XG4gIHByaXZhdGUgX3N1YnNjcmlwdGlvbldlZWtzITogU3Vic2NyaXB0aW9uO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIGNhbGVuZGFyU2VydmljZTogQ2FsZW5kYXJTZXJ2aWNlXG4gICkgeyB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgZGF0ZSA9IHRoaXMuX3N0YXJ0RGF0ZSB8fCBuZXcgRGF0ZSgpXG4gICAgdGhpcy5zZXRZZWFyTW9udGgoZGF0ZSk7XG4gICAgdGhpcy5pbml0V2Vla3MoKTtcbiAgICB0aGlzLndlZWtzID0gdGhpcy5jYWxlbmRhclNlcnZpY2UuaW5pdFdlZWtzJDtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcbiAgICBpZiAoY2hhbmdlc1sndHlwZSddICYmIChjaGFuZ2VzWyd0eXBlJ10ucHJldmlvdXNWYWx1ZSAhPT0gY2hhbmdlc1sndHlwZSddLmN1cnJlbnRWYWx1ZSkpIHtcbiAgICAgIHRoaXMuaW5pdFdlZWtzKCk7XG4gICAgfVxuICAgIGlmIChjaGFuZ2VzWydlbmREYXRlJ10gJiYgKGNoYW5nZXNbJ2VuZERhdGUnXS5wcmV2aW91c1ZhbHVlICE9PSBjaGFuZ2VzWydlbmREYXRlJ10uY3VycmVudFZhbHVlKSkge1xuICAgICAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKGNoYW5nZXNbJ2VuZERhdGUnXS5jdXJyZW50VmFsdWUpO1xuICAgICAgZW5kRGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcblxuICAgICAgdGhpcy5fZW5kRGF0ZSA9IGVuZERhdGU7XG4gICAgICB0aGlzLnNldFllYXJNb250aChlbmREYXRlKTtcbiAgICAgIHRoaXMuaW5pdFdlZWtzKCk7XG4gICAgfVxuICAgIGlmIChjaGFuZ2VzWydzdGFydERhdGUnXSAmJiAoY2hhbmdlc1snc3RhcnREYXRlJ10ucHJldmlvdXNWYWx1ZSAhPT0gY2hhbmdlc1snc3RhcnREYXRlJ10uY3VycmVudFZhbHVlKSkge1xuICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoY2hhbmdlc1snc3RhcnREYXRlJ10uY3VycmVudFZhbHVlKTtcbiAgICAgIHN0YXJ0RGF0ZS5zZXRIb3VycygwLCAwLCAwLCAwKTtcblxuICAgICAgdGhpcy5fc3RhcnREYXRlID0gc3RhcnREYXRlO1xuICAgICAgdGhpcy5zZXRZZWFyTW9udGgoc3RhcnREYXRlKTtcbiAgICAgIHRoaXMuaW5pdFdlZWtzKCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgaWYodGhpcy5fc3Vic2NyaXB0aW9uV2Vla3MpIHtcbiAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbldlZWtzLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGluaXRXZWVrcygpOiB2b2lkIHtcbiAgICB0aGlzLmNhbGVuZGFyU2VydmljZVxuICAgICAgLmRlY29tcG9zZU1vbnRoSW50b1dlZWtzKFxuICAgICAgICB0aGlzLmN1cnJlbnRZZWFyLFxuICAgICAgICB0aGlzLmN1cnJlbnRNb250aCxcbiAgICAgICAgdGhpcy50eXBlLFxuICAgICAgICB0aGlzLmlzU2hvd0RheXNPdGhlck1vbnRoLFxuICAgICAgICB0aGlzLl9zdGFydERhdGUsXG4gICAgICAgIHRoaXMuX2VuZERhdGVcbiAgICAgICk7XG4gIH1cblxuICBwdWJsaWMgdHJhY2tCeUluZGV4KGluZGV4OiBudW1iZXIsIGl0ZW06IGFueSk6IG51bWJlciB7XG4gICAgcmV0dXJuIGluZGV4OyAvLyBSYXN0cmVhIHBvciDDrW5kaWNlXG4gIH1cblxuICBwdWJsaWMgc2V0Q2VsbEFzcGVjdFJhdGlvKG51bUNvbHM6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IHBhZGRpbmcgPSAoMTAwICogdGhpcy5jZWxsQXNwZWN0UmF0aW8pIC8gbnVtQ29scyAvIDI7XG4gICAgdGhpcy5fY2VsbFBhZGRpbmcgPSBgJHtwYWRkaW5nLnRvRml4ZWQoMil9JWA7XG4gICAgdGhpcy5fY2VsbFdpZHRoID0gYCR7MTAwIC8gbnVtQ29sc30lYDtcblxuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgcHVibGljIG9uUHJldk1vbnRoKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmN1cnJlbnRNb250aCA9PT0gMSkge1xuICAgICAgdGhpcy5jdXJyZW50TW9udGggPSAxMjtcbiAgICAgIHRoaXMuY3VycmVudFllYXItLTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jdXJyZW50TW9udGgtLTtcbiAgICB9XG5cbiAgICB0aGlzLmluaXRXZWVrcygpO1xuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgcHVibGljIG9uTmV4dE1vbnRoKCk6IHZvaWQge1xuICAgIGlmICgodGhpcy5jdXJyZW50TW9udGggKyAxKSA9PT0gMTIpIHtcbiAgICAgIHRoaXMuY3VycmVudE1vbnRoID0gMTtcbiAgICAgIHRoaXMuY3VycmVudFllYXIrKztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jdXJyZW50TW9udGgrKztcbiAgICB9XG5cbiAgICB0aGlzLmluaXRXZWVrcygpO1xuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICB9XG5cbiAgcHVibGljIGlzRGF0ZVNlbGVjdGVkKGRhdGVVbml4OiBudW1iZXIgfCB1bmRlZmluZWQpOiBib29sZWFuIHtcbiAgICBjb25zdCBpbml0aWFsRGF0ZSA9IHRoaXMuY2FsZW5kYXJTZXJ2aWNlLmZvcm1hdFRvVW5peCh0aGlzLl9zdGFydERhdGUpO1xuXG4gICAgcmV0dXJuIGRhdGVVbml4ID09PSBpbml0aWFsRGF0ZTtcbiAgfVxuXG4gIHB1YmxpYyBpc0N1cnJlbnREYXRlKGRhdGVVbml4OiBudW1iZXIgfCB1bmRlZmluZWQpOiBib29sZWFuIHtcbiAgICBjb25zdCBjdXJyZW50RGF0ZVRvVW5peCA9IHRoaXMuY2FsZW5kYXJTZXJ2aWNlLmZvcm1hdFRvVW5peChuZXcgRGF0ZSgpKTtcblxuICAgIHJldHVybiAoZGF0ZVVuaXggPyBkYXRlVW5peCA9PT0gY3VycmVudERhdGVUb1VuaXggOiBmYWxzZSk7XG4gIH1cblxuICBwdWJsaWMgb25TZWxlY3RlZERhdGUob3B0aW9uOiBJV2Vla3MpOiB2b2lkIHtcblxuICAgIHN3aXRjaCh0aGlzLnR5cGUpIHtcbiAgICAgIGNhc2UgJ3NpbmdsZSc6XG4gICAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IHRoaXMuY2FsZW5kYXJTZXJ2aWNlLm9uU2VsZWN0ZWREYXRlU2luZ2xlKG9wdGlvbj8uSVNPODYwMSk7XG4gICAgICAgIHRoaXMuX3N0YXJ0RGF0ZSA9IHN0YXJ0RGF0ZTtcbiAgICAgICAgdGhpcy5kYXRlU2VsZWN0LmVtaXQoc3RhcnREYXRlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdyYW5nZSc6XG4gICAgICAgIHRoaXMub25TZWxlY3RlZERhdGVSYW5nZShvcHRpb24/LklTTzg2MDEpO1xuICAgICAgICB0aGlzLnRvZ2dsZU9wdGlvbkRhdGUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICBwdWJsaWMgb25TZWxlY3RlZERhdGVSYW5nZShJU084NjAxOiBzdHJpbmcgfCB1bmRlZmluZWQpOiB2b2lkIHtcbiAgICBzd2l0Y2godGhpcy5fY3VycmVudE9wdGlvbkRhdGUpIHtcbiAgICAgIGNhc2UgJ3N0YXJ0JzpcbiAgICAgICAgY29uc3Qgc3RhcnREYXRlID0gdGhpcy5jYWxlbmRhclNlcnZpY2Uub25TZWxlY3RlZERhdGVTaW5nbGUoSVNPODYwMSk7XG4gICAgICAgIHRoaXMuX3N0YXJ0RGF0ZSA9IHN0YXJ0RGF0ZTtcbiAgICAgICAgdGhpcy5pbml0V2Vla3MoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdlbmQnOlxuICAgICAgICBjb25zdCBlbmREYXRlID0gdGhpcy5jYWxlbmRhclNlcnZpY2Uub25TZWxlY3RlZERhdGVTaW5nbGUoSVNPODYwMSk7XG4gICAgICAgIHRoaXMuX2VuZERhdGUgPSBlbmREYXRlO1xuICAgICAgICB0aGlzLmluaXRXZWVrcygpO1xuXG4gICAgICAgIGlmKHRoaXMudmVyaWZ5RGF0ZVJhbmdlKCkpIHtcbiAgICAgICAgICB0aGlzLmRhdGVSYW5nZVNlbGVjdC5lbWl0KHtzdGFydDogdGhpcy5fc3RhcnREYXRlLCBlbmQ6IHRoaXMuX2VuZERhdGV9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBpc0VuZERhdGVSYW5nZShkYXRlVW5peDogbnVtYmVyIHwgdW5kZWZpbmVkKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuX2VuZERhdGUgP1xuICAgICAgICBkYXRlVW5peCA9PT0gdGhpcy5jYWxlbmRhclNlcnZpY2UuZm9ybWF0VG9Vbml4KHRoaXMuX2VuZERhdGUpIDpcbiAgICAgICAgZmFsc2VcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRZZWFyTW9udGgoZGF0ZTogRGF0ZSk6IHZvaWQge1xuICAgIGNvbnN0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoZGF0ZSk7XG5cbiAgICB0aGlzLmN1cnJlbnRZZWFyID0gY3VycmVudERhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICB0aGlzLmN1cnJlbnRNb250aCA9IChjdXJyZW50RGF0ZS5nZXRNb250aCgpICsgMSk7XG4gIH1cblxuICBwcml2YXRlIHRvZ2dsZU9wdGlvbkRhdGUoKTogdm9pZCB7XG4gICAgaWYodGhpcy5fY3VycmVudE9wdGlvbkRhdGUgPT09ICdzdGFydCcpIHtcbiAgICAgIGlmKHRoaXMuX2VuZERhdGUpIHtcbiAgICAgICAgdGhpcy5fZW5kRGF0ZSA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2N1cnJlbnRPcHRpb25EYXRlID0gJ2VuZCc7XG4gICAgfWVsc2Uge1xuICAgICAgdGhpcy5pbml0V2Vla3MoKTtcbiAgICAgIHRoaXMuX2N1cnJlbnRPcHRpb25EYXRlID0gJ3N0YXJ0JztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHZlcmlmeURhdGVSYW5nZSgpOiBib29sZWFuIHtcbiAgICBpZighdGhpcy5fZW5kRGF0ZSkgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IHN0YXJ0RGF0ZVRvVW5peCA9IHRoaXMuY2FsZW5kYXJTZXJ2aWNlXG4gICAgICAuZm9ybWF0VG9Vbml4KHRoaXMuX3N0YXJ0RGF0ZSk7XG4gICAgY29uc3QgZW5kRGF0ZVRvVW5peCA9IHRoaXMuY2FsZW5kYXJTZXJ2aWNlXG4gICAgICAuZm9ybWF0VG9Vbml4KHRoaXMuX2VuZERhdGUpO1xuXG4gICAgcmV0dXJuICEhKGVuZERhdGVUb1VuaXggPj0gc3RhcnREYXRlVG9Vbml4KTtcbiAgfVxufVxuIiwiPGRpdiBjbGFzcz1cInVpLWNhbGVuZGFyXCI+XG4gIDxkaXYgY2xhc3M9XCJ1aS1jYWxlbmRhci1jb250cm9sc1wiPlxuICAgIDxidXR0b24gYXJpYS1sYWJlbD1cIlByZXZpZXcgTW9udGhcIiAoY2xpY2spPVwib25QcmV2TW9udGgoKVwiPlxuICAgICAgPHN2ZyB3aWR0aD1cIjE2XCIgaGVpZ2h0PVwiMTZcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgZmlsbD1cIm5vbmVcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI+XG4gICAgICAgIDxwYXRoIGZpbGwtcnVsZT1cImV2ZW5vZGRcIiBjbGlwLXJ1bGU9XCJldmVub2RkXCIgZD1cIk0xNS44MzI2IDQuMTgwMjRDMTYuMDU1OCA0LjQyMDU2IDE2LjA1NTggNC44MTAyIDE1LjgzMjYgNS4wNTA1M0w5LjM3OTU1IDEyTDE1LjgzMjYgMTguOTQ5NUMxNi4wNTU4IDE5LjE4OTggMTYuMDU1OCAxOS41Nzk0IDE1LjgzMjYgMTkuODE5OEMxNS42MDk1IDIwLjA2MDEgMTUuMjQ3NyAyMC4wNjAxIDE1LjAyNDUgMTkuODE5OEw4LjE2NzM3IDEyLjQzNTFDNy45NDQyMSAxMi4xOTQ4IDcuOTQ0MjEgMTEuODA1MiA4LjE2NzM3IDExLjU2NDlMMTUuMDI0NSA0LjE4MDI0QzE1LjI0NzcgMy45Mzk5MiAxNS42MDk1IDMuOTM5OTIgMTUuODMyNiA0LjE4MDI0WlwiIGZpbGw9XCJibGFja1wiLz5cbiAgICAgIDwvc3ZnPlxuICAgIDwvYnV0dG9uPlxuICAgIDxkaXYgY2xhc3M9XCJ1aS1jYWxlbmRhci1jb250cm9scy1vdGhlcnNcIj5cbiAgICAgIDxidXR0b24+RW5lcm88L2J1dHRvbj5cbiAgICAgIDxidXR0b24+MjAyNTwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICAgIDxidXR0b24gYXJpYS1sYWJlbD1cIk5leHQgTW9udGhcIiAoY2xpY2spPVwib25OZXh0TW9udGgoKVwiPlxuICAgICAgPHN2ZyB3aWR0aD1cIjE2XCIgaGVpZ2h0PVwiMTZcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgZmlsbD1cIm5vbmVcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI+XG4gICAgICAgIDxwYXRoIGZpbGwtcnVsZT1cImV2ZW5vZGRcIiBjbGlwLXJ1bGU9XCJldmVub2RkXCIgZD1cIk04LjE2NzM3IDQuMTgwMjRDOC4zOTA1MiAzLjkzOTkyIDguNzUyMzMgMy45Mzk5MiA4Ljk3NTQ5IDQuMTgwMjRMMTUuODMyNiAxMS41NjQ5QzE1LjkzOTggMTEuNjgwMyAxNiAxMS44MzY4IDE2IDEyQzE2IDEyLjE2MzIgMTUuOTM5OCAxMi4zMTk3IDE1LjgzMjYgMTIuNDM1MUw4Ljk3NTQ5IDE5LjgxOThDOC43NTIzMyAyMC4wNjAxIDguMzkwNTIgMjAuMDYwMSA4LjE2NzM3IDE5LjgxOThDNy45NDQyMSAxOS41Nzk0IDcuOTQ0MjEgMTkuMTg5OCA4LjE2NzM3IDE4Ljk0OTVMMTQuNjIwNCAxMkw4LjE2NzM3IDUuMDUwNTNDNy45NDQyMSA0LjgxMDIgNy45NDQyMSA0LjQyMDU2IDguMTY3MzcgNC4xODAyNFpcIiBmaWxsPVwiYmxhY2tcIi8+XG4gICAgICA8L3N2Zz5cbiAgICA8L2J1dHRvbj5cbiAgPC9kaXY+XG4gIDx0YWJsZSByb2xlPVwiZ3JpZFwiIGNsYXNzPVwidWktY2FsZW5kYXItdGFibGVcIj5cbiAgICA8dGhlYWQgY2xhc3M9XCJ1aS1jYWxlbmRhci10YWJsZS1oZWFkXCI+XG4gICAgICA8dHI+XG4gICAgICAgIDx0aCBzY29wZT1cImNvbFwiPlxuICAgICAgICAgIDxzcGFuPkw8L3NwYW4+XG4gICAgICAgIDwvdGg+XG4gICAgICAgIDx0aCBzY29wZT1cImNvbFwiPlxuICAgICAgICAgIDxzcGFuPk08L3NwYW4+XG4gICAgICAgIDwvdGg+XG4gICAgICAgIDx0aCBzY29wZT1cImNvbFwiPlxuICAgICAgICAgIDxzcGFuPlg8L3NwYW4+XG4gICAgICAgIDwvdGg+XG4gICAgICAgIDx0aCBzY29wZT1cImNvbFwiPlxuICAgICAgICAgIDxzcGFuPko8L3NwYW4+XG4gICAgICAgIDwvdGg+XG4gICAgICAgIDx0aCBzY29wZT1cImNvbFwiPlxuICAgICAgICAgIDxzcGFuPlY8L3NwYW4+XG4gICAgICAgIDwvdGg+XG4gICAgICAgIDx0aCBzY29wZT1cImNvbFwiPlxuICAgICAgICAgIDxzcGFuPlM8L3NwYW4+XG4gICAgICAgIDwvdGg+XG4gICAgICAgIDx0aCBzY29wZT1cImNvbFwiPlxuICAgICAgICAgIDxzcGFuPkQ8L3NwYW4+XG4gICAgICAgIDwvdGg+XG4gICAgICA8L3RyPlxuICAgIDwvdGhlYWQ+XG4gICAgPHRib2R5IGNsYXNzPVwidWktY2FsZW5kYXItdGFibGUtYm9keVwiPlxuICAgICAgQGZvciAod2VlayBvZiB3ZWVrcyB8IGFzeW5jOyBsZXQgaWR4ID0gJGluZGV4OyB0cmFjayB0cmFja0J5SW5kZXg7KSB7XG4gICAgICA8dHIgcm9sZT1cInJvd1wiPlxuICAgICAgICBAZm9yIChkYXkgb2Ygd2VlazsgdHJhY2sgZGF5LklTTzg2MDEpIHtcbiAgICAgICAgICA8dGRcbiAgICAgICAgICAgIHJvbGU9XCJncmlkY2VsbFwiXG4gICAgICAgICAgICBbc3R5bGUud2lkdGhdPVwiX2NlbGxXaWR0aFwiXG4gICAgICAgICAgICBbc3R5bGUucGFkZGluZ1RvcF09XCJfY2VsbFBhZGRpbmdcIlxuICAgICAgICAgICAgW3N0eWxlLnBhZGRpbmdCb3R0b21dPVwiX2NlbGxQYWRkaW5nXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgcm9sZT1cIm9wdGlvblwiXG4gICAgICAgICAgICAgIFtjbGFzcy5yZWFkb25seV09XCJkYXkuaXNBbm90aGVyTW9udGhcIlxuICAgICAgICAgICAgICBbYXR0ci5kaXNhYmxlZF09XCJkYXkuaXNBbm90aGVyTW9udGggfHwgbnVsbFwiXG4gICAgICAgICAgICAgIFtjbGFzcy5yYW5nZV09XCJkYXkuaXNTZWxlY3RlZCAmJiBfZW5kRGF0ZSAmJiB0eXBlID09PSAncmFuZ2UnXCJcbiAgICAgICAgICAgICAgW2NsYXNzLmVuZC1kYXRlXT1cImlzRW5kRGF0ZVJhbmdlKGRheS51bml4KVwiXG4gICAgICAgICAgICAgIFthdHRyLnRhYkluZGV4XT1cImRheS5pc0Fub3RoZXJNb250aCA/IC0xIDogMFwiXG4gICAgICAgICAgICAgIFthdHRyLmFyaWEtY3VycmVudF09XCJpc1NlbGVjdEN1cnJlbnREYXkgJiYgdHlwZSA9PT0gJ3NpbmdsZScgPyAoaXNDdXJyZW50RGF0ZShkYXkudW5peCkgPyAnZGF0ZScgOiBudWxsKSA6IG51bGxcIlxuICAgICAgICAgICAgICBbYXR0ci5hcmlhLXNlbGVjdGVkXT1cImlzRGF0ZVNlbGVjdGVkKGRheS51bml4KVwiXG4gICAgICAgICAgICAgIFthdHRyLmRhdGEtZGF0ZV09XCJkYXkuSVNPODYwMSB8fCBudWxsXCJcbiAgICAgICAgICAgICAgKGNsaWNrKT1cIm9uU2VsZWN0ZWREYXRlKGRheSlcIj5cbiAgICAgICAgICAgICAge3sgZGF5LmRheSB9fVxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgPC90ZD5cbiAgICAgICAgfVxuICAgICAgPC90cj5cbiAgICAgIH1cbiAgICA8L3Rib2R5PlxuICA8L3RhYmxlPlxuPC9kaXY+XG4iXX0=